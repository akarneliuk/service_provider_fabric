    /edit-config global
{% for routing_protocol in routing %}
{% if routing_protocol.id == 'BGP' %}{# 001: configuration of BGP process #}
    /configure router "Base" autonomous-system {{ routing_protocol.asn }}
{% for iface in interfaces %}
{% if iface.name == 'system' %}
    /configure router "Base" bgp router-id "{{ iface.ipv4.address }}"
{% endif %}
{% endfor %}
    /configure router "Base" bgp next-hop-resolution labeled-routes transport-tunnel family vpn resolution filter
    /configure router "Base" bgp next-hop-resolution labeled-routes transport-tunnel family vpn resolution-filter sr-isis true
{% for peer_group in routing_protocol.peer_groups %}
    /configure router "Base" bgp group "{{ peer_group.id }}" peer-as {{ peer_group.peer_asn }}
{% for iface in interfaces %}
{% if iface.name == 'system' %}
    /configure router "Base" bgp group "{{ peer_group.id }}" local-address "{{ iface.ipv4.address }}"
{% endif %}
{% endfor %}
{% for afi_safi in routing_protocol.af %}
{% if afi_safi.afi == 'L2VPN' and afi_safi.safi == 'EVPN' %}
    /configure router "Base" bgp group "{{ peer_group.id }}" family evpn true
{% elif afi_safi.afi == 'L3VPN_IPV4' and afi_safi.safi == 'UNICAST' %}
    /configure router "Base" bgp group "{{ peer_group.id }}" family vpn-ipv4 true
{% elif afi_safi.afi == 'L3VPN_IPV6' and afi_safi.safi == 'UNICAST' %}
    /configure router "Base" bgp group "{{ peer_group.id }}" family vpn-ipv6 true
{% endif %}
{% endfor %}
{% endfor %}
{% for bgp_neighbor in routing_protocol.neighbors %}
    /configure router "Base" bgp neighbor "{{ bgp_neighbor.id }}" group "{{ bgp_neighbor.peer_group }}"
{% endfor %}
{% endif %}{# 001: configuration of BGP process #}
{% endfor %}
    /commit
    /quit-config
